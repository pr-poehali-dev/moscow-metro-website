<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import Metro Data</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöá Import Metro Data to Database</h1>
        <p>Click the button below to import all metro lines and stations into the database.</p>
        <button id="importBtn" onclick="importData()">Import Metro Data</button>
        <div id="result"></div>
    </div>

    <script type="module">
        const metroLines = [
          { id: 'sokolnicheskaya', name: '–°–æ–∫–æ–ª—å–Ω–∏—á–µ—Å–∫–∞—è', color: '#E4002B', number: '1' },
          { id: 'zamoskvoretskaya', name: '–ó–∞–º–æ—Å–∫–≤–æ—Ä–µ—Ü–∫–∞—è', color: '#2DBE2C', number: '2' },
          { id: 'arbatsko-pokrovskaya', name: '–ê—Ä–±–∞—Ç—Å–∫–æ-–ü–æ–∫—Ä–æ–≤—Å–∫–∞—è', color: '#0078C9', number: '3' },
          { id: 'filevskaya', name: '–§–∏–ª—ë–≤—Å–∫–∞—è', color: '#19C1F3', number: '4' },
          { id: 'koltsevaya', name: '–ö–æ–ª—å—Ü–µ–≤–∞—è', color: '#894E35', number: '5' },
          { id: 'kaluzhsko-rizhskaya', name: '–ö–∞–ª—É–∂—Å–∫–æ-–†–∏–∂—Å–∫–∞—è', color: '#F58631', number: '6' },
          { id: 'tagansko-krasnopresnenskaya', name: '–¢–∞–≥–∞–Ω—Å–∫–æ-–ö—Ä–∞—Å–Ω–æ–ø—Ä–µ—Å–Ω–µ–Ω—Å–∫–∞—è', color: '#8E479C', number: '7' },
          { id: 'kalininskaya', name: '–ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∞—è', color: '#FFCD1C', number: '8' },
          { id: 'solntsevskaya', name: '–°–æ–ª–Ω—Ü–µ–≤—Å–∫–∞—è', color: '#FFD702', number: '8–ê' },
          { id: 'serpukhovsko-timiryazevskaya', name: '–°–µ—Ä–ø—É—Ö–æ–≤—Å–∫–æ-–¢–∏–º–∏—Ä—è–∑–µ–≤—Å–∫–∞—è', color: '#999999', number: '9' },
          { id: 'lyublinsko-dmitrovskaya', name: '–õ—é–±–ª–∏–Ω—Å–∫–æ-–î–º–∏—Ç—Ä–æ–≤—Å–∫–∞—è', color: '#B3D445', number: '10' },
          { id: 'bolshaya-koltsevaya', name: '–ë–æ–ª—å—à–∞—è –∫–æ–ª—å—Ü–µ–≤–∞—è', color: '#82C0C0', number: '11' },
          { id: 'butovskaya', name: '–ë—É—Ç–æ–≤—Å–∫–∞—è', color: '#ACB5BD', number: '12' },
          { id: 'monorail', name: '–ú–æ–Ω–æ—Ä–µ–ª—å—Å', color: '#79CDCD', number: '13' },
          { id: 'mck', name: '–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∫–æ–ª—å—Ü–æ', color: '#F59BBB', number: '14' },
          { id: 'nekrasovskaya', name: '–ù–µ–∫—Ä–∞—Å–æ–≤—Å–∫–∞—è', color: '#DE64A1', number: '15' },
          { id: 'troitskaya', name: '–¢—Ä–æ–∏—Ü–∫–∞—è', color: '#DD0000', number: '16' },
          { id: 'rublevo-arkhangelskaya', name: '–†—É–±–ª–µ–≤–æ-–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è', color: '#FFA8AF', number: '17' },
          { id: 'biryulevskaya', name: '–ë–∏—Ä—é–ª–µ–≤—Å–∫–∞—è', color: '#A1E9E9', number: '18' },
          { id: 'd1', name: '–ë–µ–ª–æ—Ä—É—Å—Å–∫–æ-–°–∞–≤—ë–ª–æ–≤—Å–∫–∏–π –¥–∏–∞–º–µ—Ç—Ä', color: '#F08521', number: 'D1' },
          { id: 'd2', name: '–ö—É—Ä—Å–∫–æ-–†–∏–∂—Å–∫–∏–π –¥–∏–∞–º–µ—Ç—Ä', color: '#D375B9', number: 'D2' },
          { id: 'd3', name: '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ-–ö–∞–∑–∞–Ω—Å–∫–∏–π –¥–∏–∞–º–µ—Ç—Ä', color: '#11C0E7', number: 'D3' },
          { id: 'd4', name: '–ö–∞–ª—É–∂—Å–∫–æ-–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∏–π –¥–∏–∞–º–µ—Ç—Ä', color: '#B7DD7D', number: 'D4' },
        ];

        // Sample of first 50 stations (you'll need to add all stations here)
        const metroStations = [
          { id: 'sok-0', name: '–ü–æ—Ç–∞–ø–æ–≤–æ', lineId: 'sokolnicheskaya', hasTransfer: false, transferTo: [], order: 0 },
          { id: 'sok-1', name: '–ë—É–ª—å–≤–∞—Ä –†–æ–∫–æ—Å—Å–æ–≤—Å–∫–æ–≥–æ', lineId: 'sokolnicheskaya', hasTransfer: false, transferTo: [], order: 1 },
          { id: 'sok-6', name: '–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∞—è', lineId: 'sokolnicheskaya', hasTransfer: true, transferTo: ['koltsevaya'], order: 6 },
        ];

        window.importData = async function() {
            const btn = document.getElementById('importBtn');
            const resultDiv = document.getElementById('result');
            
            btn.disabled = true;
            resultDiv.className = 'info';
            resultDiv.textContent = 'Importing data...';
            
            const transfers = metroStations
                .filter(s => s.hasTransfer && s.transferTo && s.transferTo.length > 0)
                .map(s => ({ stationId: s.id, transferTo: s.transferTo }));
            
            const payload = {
                lines: metroLines,
                stations: metroStations.map(s => ({
                    id: s.id,
                    name: s.name,
                    lineId: s.lineId,
                    order: s.order,
                    hasTransfer: s.hasTransfer
                })),
                transfers: transfers
            };
            
            try {
                const response = await fetch('https://functions.poehali.dev/9ec91258-742b-41c4-9735-af020ee61843?resource=bulk-import', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'success';
                    resultDiv.textContent = `‚úÖ Import completed!\n\nLines imported: ${result.lines_imported}\nStations imported: ${result.stations_imported}\nTransfers imported: ${result.transfers_imported}`;
                } else {
                    resultDiv.className = 'error';
                    resultDiv.textContent = `‚ùå Import failed:\n${JSON.stringify(result, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.textContent = `‚ùå Error: ${error.message}`;
            } finally {
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
